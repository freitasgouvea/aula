<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <title>Laurea - Aula</title>

    <!-- Styles -->
    <link href="css/page.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <!-- Favicons -->
    <link rel="apple-touch-icon&quot; href=&quot;img/apple-touch-icon.png">
    <link rel="icon" href="favicon.png">
</head>

<body onload="getWeb3()">

    <main>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light navbar-stick-dark" data-navbar="smart">
            <div class="container">

                <div class="navbar-left mr-4">
                    <button class="navbar-toggler text-white" type="button">&#9776;</button>
                </div>

                <section class="navbar-mobile">
                    <h3 class="text-success">Laurea <i class="fab fa-pagelines text-success"></i></h3>
                    </a>
                    <nav class="nav nav-navbar mr-auto">
                        <a class="nav-link active" href="index.html">Aula</a>
                    </nav>
                </section>


            </div>
        </nav>
        <!-- /.navbar -->


        <!-- Header -->
        <header class="header text-white" style="background-color: #4f407b" data-overlay="1">
            <div class="container text-center">

                <div class="row">
                    <div class="col-md-8 mx-auto">

                        <h1 class="text-white">Aula <span class="text-success">Laurea <i
                                    class="fab fa-pagelines text-success"></i></span></h1>

                    </div>
                </div>

            </div>
        </header><!-- /.header -->


        <section class="section">

            <div class="container-fluid">
                <header class="section-header">
                    <span class="iconbox iconbox-outline iconbox-xl"><i
                            class="fas fa-check-square text-success"></i></span>
                    <br>
                    <br>
                    <h2>Registre sua presença</h2>
                    <hr>
                    <p class="lead">Sua presença será armazenada no Blockchain.</p>
                </header>

                <div id="registro" class="row">
                    <form action="#" method="get" name="formRegistro" id="formRegistro"
                        class="col-11 col-md-6 col-xl-5 bg-light mx-auto section-dialog p-5 p-md-7">
                        <p class="lead-2 mx-4"><i class="fas fa-award fa-fw mr-3"></i> Curso de Smart Contracts</p>

                        <div class="form-group input-group input-group-lg">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i
                                        class="fas fa-chalkboard-teacher fa-fw mr-2"></i></span>
                            </div>
                            <select type="number" name="classID" id="classID" class="form-control"
                                placeholder="Select input">
                                <option value="0">Aula 01</option>
                                <option value="1">Aula 02</option>
                                <option value="2">Aula 03</option>
                                <option value="3">Aula 04</option>
                                <option value="4">Aula 05</option>
                                <option value="5">Aula 06</option>
                                <option value="6">Aula 07</option>
                                <option value="7">Aula 08</option>
                                <option value="8">Aula 09</option>
                                <option value="9">Aula 10</option>
                                <option value="10">Aula 11</option>
                                <option value="11">Aula 12</option>
                                <option value="12">Aula 13</option>
                                <option value="13">Aula 14</option>
                                <option value="14">Aula 15</option>
                                <option value="15">Aula 16</option>
                                <option value="16">Aula 17</option>
                                <option value="17">Aula 18</option>
                                <option value="18">Aula 19</option>
                                <option value="19">Aula 20</option>
                            </select>
                        </div>

                        <div class="form-group input-group input-group-lg">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-user-graduate fa-fw"></i></span>
                            </div>
                            <input type="number" name="studentID" id="studentID" class="form-control"
                                placeholder="Número do Aluno">
                        </div>

                        <div class="form-group input-group input-group-lg">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-key fa-fw"></i></span>
                            </div>
                            <input type="number" name="_password" id="_password" class="form-control"
                                placeholder="Senha da Aula">
                        </div>

                        <button type="button" onclick="registerAttendance()" data-toggle="popup"
                            data-target="#popup-basic" class="btn btn-block btn-lg btn-success">Registrar</button>

                    </form>
                </div>
            </div>

            </div>

        </section>

        <div id="popup-basic" class="popup col-10 col-md-10" data-position="bottom-center">
            <button type="button" class="close" data-dismiss="popup" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
            <h4 class="text-center text-dark">Confirme a operação no Metamask</h4>
            <br>
            <div class="alert" id="statusTransacao">&nbsp;</div>
        </div>


    </main>

    <!-- Footer -->
    <footer class="footer py-7">
        <div class="container text-center">
            <br>
            <h3 class="text-success">Laurea <i class="fab fa-pagelines text-success"></i></h3>
            <small>© Laurea 2019, All rights reserved.</small>
            <br>
        </div>
    </footer><!-- /.footer -->

    <!-- Scroll top -->
    <button class="btn btn-circle btn-success scroll-top"><i class="fa fa-angle-up"></i></button>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Scripts -->
    <script src="js/page.min.js"></script>
    <script src="js/script.js"></script>

    <!-- Smart Contract Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="connectToSmartContract.js"></script>
    <script src="abi.js"></script>
    <script>

        var frmRegistro = document.formRegistro;

        function registerAttendance() {
            event.preventDefault();
            $("#statusTransacao").html("&nbsp;");
            contract.registerAttendance(frmRegistro.studentID.value, frmRegistro.classID.value, frmRegistro._password.value, { from: web3.eth.accounts[0], gas: 3000000, value: 0 }, function (erro, resultado) {
                if (erro) {
                    console.log("registerAttendance");
                    console.error(erro);
                    alert("Houve um erro ao registrar a sua presença, tente novamente.");
                    return
                }
                waitForTxToBeMined(resultado, "#statusTransacao");
            })
        }

    </script>

</body>

</html>
